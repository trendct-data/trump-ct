{
    "collab_server" : "",
    "contents" : "library(dplyr)\nlibrary(tidyr)\n\n## Republicans\n\nrep_results <- read.csv(\"data/RepublicanPresidentialPreferencePrimary.csv\", stringsAsFactors=FALSE)\nrep_results <- rep_results %>%\n  group_by(Town.Name, Candidate.Name) %>%\n  summarise(votes=sum(Vote.Totals))\n\nrep_results$Candidate.Name <- gsub(\"Donald J. Trump\", \"trump_count\", rep_results$Candidate.Name)\nrep_results$Candidate.Name <- gsub(\"John R. Kasich\", \"kasich_count\", rep_results$Candidate.Name)\nrep_results$Candidate.Name <- gsub(\"Ben Carson\", \"others_count\", rep_results$Candidate.Name)\nrep_results$Candidate.Name <- gsub(\"Ted Cruz\", \"others_count\", rep_results$Candidate.Name)\nrep_results$Candidate.Name <- gsub(\"Uncommitted\", \"others_count\", rep_results$Candidate.Name)\n\nrep_results <- rep_results %>%\n  group_by(Town.Name, Candidate.Name) %>%\n  summarise(votes=sum(votes)) %>%\n  spread(Candidate.Name, votes)\n\nrep_results$vote_diff <- rep_results$trump_count - rep_results$kasich_count\nrep_results$total <- rep_results$trump_count + rep_results$kasich_count + rep_results$others_count\nrep_results$trump_per <- round(rep_results$trump_count/rep_results$total*100,1)\nrep_results$kasich_per <- round(rep_results$kasich_count/rep_results$total*100,1)\nrep_results$others_per <- round(rep_results$others_count/rep_results$total*100,1)\nrep_results$percent_diff <- rep_results$trump_per - rep_results$kasich_per\nnames(rep_results)[names(rep_results) == 'Town.Name'] <- 'Town'\nrep_results <- data.frame(rep_results)\n\n## Democrats\n\ndem_results_sos <- read.csv(\"data/DemocraticPresidentialPreferencePrimary.csv\", stringsAsFactors=FALSE)\ndem_results_sos <- dem_results_sos %>%\n  group_by(Town.Name, Candidate.Name) %>%\n  summarise(votes=sum(Vote.Totals))\n\ndem_results_sos$Candidate.Name <- gsub(\"Bernie Sanders\", \"sanders_count\", dem_results_sos$Candidate.Name)\ndem_results_sos$Candidate.Name <- gsub(\"Hillary Clinton\", \"clinton_count\", dem_results_sos$Candidate.Name)\ndem_results_sos$Candidate.Name <- gsub(\"Roque Rocky De La Fuente\", \"others_count\", dem_results_sos$Candidate.Name)\ndem_results_sos$Candidate.Name <- gsub(\"Uncommitted\", \"others_count\", dem_results_sos$Candidate.Name)\n\ndem_results_sos <- dem_results_sos %>%\n  group_by(Town.Name, Candidate.Name) %>%\n  summarise(votes=sum(votes)) %>%\n  spread(Candidate.Name, votes)\n\nstr(dem_results_sos)\ndem_results_sos$vote_diff <- dem_results_sos$clinton_count - dem_results_sos$sanders_count\ndem_results_sos$total <- dem_results_sos$clinton_count + dem_results_sos$sanders_count + dem_results_sos$others_count\ndem_results_sos$clinton_per <- round(dem_results_sos$clinton_count/dem_results_sos$total*100,1)\ndem_results_sos$sanders_per <- round(dem_results_sos$sanders_count/dem_results_sos$total*100,1)\ndem_results_sos$others_per <- round(dem_results_sos$others_count/dem_results_sos$total*100,1)\ndem_results_sos$percent_diff <- dem_results_sos$clinton_per - dem_results_sos$sanders_per\n\nnames(dem_results_sos)[names(dem_results_sos) == 'Town.Name'] <- 'Town'\ndem_results <- dem_results_sos\n\n\nclinton <- dem_results[c(\"Town\", \"clinton_count\", \"sanders_count\")]\ntrump <- rep_results[c(\"Town\", \"trump_count\", \"total\")]\n\nclinton_trump <- left_join(clinton, trump)\nclinton_trump$ct <- ifelse(clinton_trump$trump_count > clinton_trump$clinton_count, \"trump\", \"clinton\")\n\ntable(clinton_trump$ct)\n\nc_t <- clinton_trump %>%\n  summarise(clinton=sum(clinton_count), trump=sum(trump_count))\nc_t\n\nc_t_r <- clinton_trump %>%\n  summarise(clinton=sum(clinton_count), trump=sum(total))\nc_t_r\n\nclinton_trump$trump_sanders <- clinton_trump$sanders_count+clinton_trump$trump_count\n\nclinton_trump$cts <- ifelse(clinton_trump$trump_sanders > clinton_trump$clinton_count, \"trump\", \"clinton\")\n\ntable(clinton_trump$cts)\n\nc_t_b <- clinton_trump %>%\n  summarise(clinton=sum(clinton_count), trump=sum(trump_sanders))\nc_t_b\ntapply(clinton_trump$trump_count, clinton_trump$cts, sum)\n\n\n## 2008\n\np2008 <- read.csv(\"data/2008presidential.csv\")\n\np2008$winner <- ifelse(p2008$McCain.Palin>p2008$Obama.Biden, \"McCain.Palin\", \"Obama.Biden\")\n\ntable(p2008$winner)\n\np2008_winner <- p2008 %>%\n  summarise(mccain=sum(McCain.Palin), obama=sum(Obama.Biden))\np2008_winner\n\nlibrary(tidyr)\nlibrary(dplyr)\nlibrary(scales)\nlibrary(ggplot2)\nlibrary(ggalt)\nlibrary(stringr)\nlibrary(knitr)\n\nlibrary(rgdal)\nrequire(maptools)\n\n\ntown_shape <- readOGR(dsn=\"maps\", layer=\"ctgeo\")\ntown_shape_df <- fortify(town_shape, region=\"NAME10\")\n\ntown_map <- p2008\n\nnames(town_map)[names(town_map) == 'Town'] <- 'id'\n\nvoters_map <- left_join(town_shape_df, town_map)\n\n\ntheme_opts <- list(theme(panel.grid.minor = element_blank(),\n                         panel.grid.major = element_blank(),\n                         panel.background = element_blank(),\n                         plot.background = element_rect(fill=\"#e6e8ed\"),\n                         panel.border = element_blank(),\n                         axis.line = element_blank(),\n                         axis.text.x = element_blank(),\n                         axis.text.y = element_blank(),\n                         axis.ticks = element_blank(),\n                         axis.title.x = element_blank(),\n                         axis.title.y = element_blank(),\n                         plot.title = element_text(size=22)))\n\n# plot map\nggplot(voters_map, aes(long,lat, group=group, fill=winner)) + \n  geom_polygon() + \n  geom_path(color = \"white\") +\n  labs(title=\"2008 presidential election winners by town\") + \n  coord_equal() + \n  theme_opts\n\n\n\nmccain_town_map <- p2008 %>%\n  filter(winner==\"McCain.Palin\")\n\nnames(mccain_town_map)[names(mccain_town_map) == 'Town'] <- 'id'\n\nmccain_voters_map <- left_join(town_shape_df, mccain_town_map)\nmccain_voters_map <- mccain_voters_map[!is.na(mccain_voters_map$winner),]\n\n# plot map\nggplot(mccain_voters_map, aes(long,lat, group=group, fill=winner)) + \n  geom_polygon() +\n  geom_path(color = \"white\") +\n  labs(title=\"Towns McCain and Palin won in 2008\") + \n  coord_equal() + \n  theme_opts\n\n## registered voters\n\nreg <- read.csv(\"data/ACTIVE_VOTER_BY_TOWN_PARTY_072116.csv\")\n\nlibrary(stringr)\nreg$Affiliation <- gsub(\" 1\", \"\", reg$Affiliation)\nreg$Affiliation <- gsub(\" 2\", \"\", reg$Affiliation)\nreg$Affiliation <- gsub(\" 3\", \"\", reg$Affiliation)\nreg$Affiliation <- gsub(\" 4\", \"\", reg$Affiliation)\nreg$Affiliation <- str_trim(reg$Affiliation)\n\nreg <- reg %>%\n  spread(Affiliation, Registered)\n\n\n# Quinnipiac\n\nRep\tDem\n9%\t85%\n  79\t5\n\n(.09 * 425839) + (.85*734572) + (.36*803358)\n(.79 * 425839) + (.05*734572) + (.41*803358)\n\n\nTot Rep Dem Ind Men Wom Yes No\nClinton 41% 8% 81% 30% 32% 49% 45% 38%\n  Trump 36 75 6 38 45 28 33 38\n\n(.08 * 425839) + (.81*734572) + (.30*803358)\n(.75 * 425839) + (.06*734572) + (.38*803358)aZZ\n",
    "created" : 1469128799777.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2894283076",
    "id" : "3EFACC0F",
    "lastKnownWriteTime" : 1469387537,
    "last_content_update" : 1469387537,
    "path" : "~/Documents/Github/data/2016/07/trump_ct/trump.R",
    "project_path" : "trump.R",
    "properties" : {
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}